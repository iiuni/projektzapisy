{% extends "offer/base.html" %}

{% load proposal_status %}
{% load vote_filters %}
{% load render_bundle from webpack_loader %}

{% block main-subtitle %}Podsumowanie głosowania{% endblock %}

{% block offer_menu_vote %} class="active"{% endblock %}

{% block bread %}
    <li class="breadcrumb-item"><a href="/">Strona główna</a></li>
    <li class="breadcrumb-item"><a href="{% url 'offer-main' %}">Oferta dydaktyczna</a></li>
    <li class="breadcrumb-item"><a href="{% url 'vote-main' %}">Głosowanie</a></li>
    <li class="breadcrumb-item active">Podsumowanie</li>
{% endblock bread %}

{% block all-content %}
    <h1>Podsumowanie głosowania</h1>
    {% regroup proposals|semester_order by semester as proposals_per_semester %}
    <table class="table table-striped">
    {% for semester, proposals_in_semester in proposals_per_semester %}
        <tbody class="semester">
            <tr>
                <th colspan="4"><h2>Semestr {{ semester|semester_display }}</h2></th>
            </tr>
        </tbody>
        {% if proposals_in_semester %}
        <tbody class="headers">
            <tr>
                <th scope="col">Propozycja przedmiotu</th>
                <th scope="col">Suma punktów</th>
                <th scope="col">Liczba głosujących</th>
                <th></th>
            </tr>
        </tbody>
        <tbody class="proposals">
            {% for proposal in proposals_in_semester %}
            <tr>
                <td><a href="{% url 'offer-page' slug=proposal.slug %}">{{ proposal.name }}</a></td>
                <td class="text-center">{{ proposal.total|default_if_none:0 }}</td>
                <td class="text-center">{{ proposal.count }}</td>
                <td><a href="{% url 'proposal-vote-summary' slug=proposal.slug %}">lista</a></td>
            </tr>
            {% endfor %}
        </tbody>
        {% else %}
        <tbody class="alert alert-info">
            <tr>
                <td>
                    Nikt na nic jeszcze nie zagłosował.
                </td>
            </tr>
        </tbody>
        {% endif %}
    {% endfor %}
    </table>

    {% render_bundle 'vote-sortable-table' %}
{% endblock all-content %}
