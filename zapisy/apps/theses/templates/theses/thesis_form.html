{% extends "base.html" %}
{% load render_bundle from webpack_loader %}

{% load crispy_forms_tags %}

{% block main-subtitle %}System prac dyplomowych{% endblock %}

{% block theses_active %} class="active"{% endblock %}

{% block all-content %}
<div id="thesis-root">
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="d-inline-block">
        {% if new_thesis %}
            Dodawanie nowej pracy dyplomowej
        </h1>
        {% else %}
            Edycja pracy dyplomowej
        </h1>
        <form action="{% url 'theses:delete_thesis' id %}" method="POST" class="post-form">
            {% csrf_token %}
            <div class="text-right">
            <input class="btn btn-default btn-danger confirm-delete float-right align-bottom ml-3" name="delete" type="submit" value="Usuń pracę"/>
            <script>
                $(document).on('click', '.confirm-delete', function(){
                    return confirm('Czy na pewno chcesz usunąć tę pracę dyplomową?');
                })
            </script>
            </div>
        </form>
        {% endif %}
    </div>
    {% if confirm_changes %}
        <div class="d-flex justify-content-between align-items-center">
            <div class="alert alert-warning">
                Temat został już zaakceptowany przez komisję. Wprowadzenie zmian innych niż dotyczące
                daty rezerwacji i przypisanych studentów spowoduje przesłanie go z powrotem do decyzji komisji.
            </div>
            <div class="text-right">
                <input class="btn btn btn-primary edit-term-form ml-3" name="confirm" type="submit" value="Cofnij zmiany" onclick="reset_changes()"/>
            </div>
        </div>
    {% endif %}

    <form method="POST" class="post-form confirm-submit">
        {% csrf_token %}
        {% crispy thesis_form %}
    </form>
    {% if confirm_changes %}
        {{ old_instance|json_script:"old_instance" }}
        {% render_bundle 'theses-theses-change' %} 
    {% endif %}
    <script>
        function reset_changes() {
            const old_instance = JSON.parse(
                document.getElementById("old_instance").textContent
            );
            document.querySelector('[name="title"]').value = old_instance.title
            document.querySelector('[name="supporting_advisor"]').value = old_instance.supporting_advisor
            document.querySelector('[name="kind"]').value = old_instance.kind
            document.querySelector('[name="max_number_of_students"]').value = old_instance.max_number_of_students
            document.querySelector('textarea[name="description"]').value = old_instance.description
        }
    </script>
</div>
{% endblock %}
