{% extends "enrollment/base.html" %}
{% load i18n %}
{% load render_bundle from webpack_loader %}

{% block main-subtitle %}{# Translators: podtytuł #}{% trans "Prototyp planu" %}{% endblock %}

{% block enrollment_menu_prototype %} class="active"{% endblock %}

{% block bread %}
    <li class="breadcrumb-item">
        <a href="{% url 'main-page' %}">{% trans "Strona główna" %}</a>
    </li>

    <li class="breadcrumb-item active" aria-current="page">
        <a href="{% url 'course-list' %}">{% trans "Zapisy" %}</a>
    </li>
{% endblock %}

{% block sidebar %}
    <div id="course-list"></div>
{% endblock %}

{% block top-content %}
    <div id="course-filter"></div>
{% endblock %}


{% block content %}
    <div class="row" id="timetable"></div>
    {{ groups_json|json_script:"timetable-data" }}
    {{ courses_json|json_script:"courses-list" }}
    {{ filters_json|json_script:"filters-data" }}
    <input id="prototype-update-url" type="hidden" value="{% url 'prototype-update' %}">

    <div class="mt-3 border-top pt-3">
        <h4>{% trans "Legenda" %}</h4>
        <ul class="schedule-legend">
            <li>Prototyp <strong>aktualizuje się</strong> regularnie. Nie trzeba odświeżać tej strony.</li>
        </ul>
        <ul class="schedule-legend">
            <li><div class="legend-box enrolled"></div> — Jesteś zapisany do tej grupy.</li>
            <li><div class="legend-box enqueued"></div> — Jesteś w kolejce do tej grupy.</li>
            <li><div class="legend-box pinned"></div> — Grupa przypięta do prototypu.</li>
        </ul>
        <ul class="schedule-legend">
            <li>
                <span class="legend-box">
                    <i class="fa fa-thumbtack fa-rotate-90 fa-fw"></i>
                </span> — Przypina do prototypu.
                Widoczność grupy w prototypie zostaje zapamiętana. Przycisk
                <strong>nie zapisuje</strong> na zajęcia.
            </li>
            <li>
                <span class="legend-box">
                    <i class="fa fa-thumbtack fa-fw" data-fa-transform="rotate-45"></i>
                </span> — Odpina od prototypu.
                Przywraca domyślną widoczność grupy w prototypie. Przycisk
                <strong>nie wypisuje</strong> z zajęć.
            </li>
            <li>
                <span class="legend-box">
                    <i class="fa fa-pencil-alt fa-fw"></i>
                </span> — Zapisuje do kolejki.
                Jak tylko w grupie będzie wolne miejsce (być może natychmiast),
                studenci z przodu kolejki zostaną do niej wciągnięci przez
                asynchroniczny proces.
            </li>
            <li>
                <span class="legend-box">
                    <i class="fa fa-ban fa-fw"></i>
                </span> — Wypisuje z grupy lub
                jej kolejki.
            </li>
            <li>
                <span class="legend-box">
                    <i class="fa fa-car-side fa-fw"></i>
                </span> — Grupa z auto-zapisem. Stan tej grupy jest automatycznie synchronizowany z
                innymi grupami tego przedmiotu. Zapisz się do innych grup, a automatycznie się w niej
                znajdziesz.
            </li>
        </ul>
    </div>
    {% if user.student %}
    <h3>{% trans "Zajęcia, na które jesteś zapisany" %}</h3>
    <div class="table-responsive">
	<table id="enr-schedule-listByCourse" class="table table-striped">
		<thead>
			<tr>
                {# Translators: Tytuł kolumny w tabelce #}
				<th scope="col">{% trans "Przedmiot" %}</th>
				{% if user.student %}
                    {# Translators: Tytuł kolumny w tabelce #}
                    <th class="ects" scope="col">{% trans "ECTS" %}</th>
                {% else %}
                    {# Translators: Tytuł kolumny w tabelce #}
                    <th class="ects" scope="col">{% trans "Godziny" %}</th>
                {% endif %}
			</tr>
		</thead>
		<tfoot>
			<tr>
                <td><strong>Suma punktów ECTS:</strong></td>
                <td class="ects">{{ sum_points }}</td>
			</tr>
		</tfoot>
		<tbody>
            {% regroup groups|dictsort:"course_id" by course as courses %}
            {% for course in courses %}
            <tr class="courseHeader">
                <td class="name" scope="col">
                    <a href="{% url 'course-page' course.grouper.slug %}">
                        {{ course.grouper.name }}
                    </a>

                </td>
                <td rowspan="2" class="ects">
                    {{ course.grouper.points }}
                </td>
            </tr>
            <tr class="courseDetails">
                <td>
                    <ul>
                        {% for item in course.list %}
                        {% with item as group %}
                        <li>
                            <span class="type">{{ group.get_type_display }}:</span>
                            {% for term in group.term.all %}
                            <span class="term">
                                {{ term.get_dayOfWeek_display }}
                                {{ term.start_time|time:'G:i' }}-{{ term.end_time|time:'G:i' }}
                            </span>
                            <span class="classroom">sala:
                                  {% for classroom in term.classrooms.all %}
                                    {{ classroom.number }}
                                  {% endfor %}
                            </span>
                            {% endfor %}
                        </li>
                        {% endwith %}
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
		</tbody>
    </table>
    </div>  
    {% endif %}
{% endblock %}

{% block rendered_bundles %}
    {% render_bundle 'timetable-prototype-component' %}
    {% render_bundle 'timetable-prototype-legend-stylesheet' %}
{% endblock %}

