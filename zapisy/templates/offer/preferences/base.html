{% extends "offer/base.html" %}

{% load compressed %}
{% load i18n %}

{% block main-subtitle %}Preferencje{% endblock %}

{% block enrollment_preferences %} class="active"{% endblock %}

{% block bread %}
	<a href="/">Strona główna</a> &raquo;
	<a href="{% url 'offer-main' %}">Oferta</a> &raquo;
	Preferencje
{% endblock %}

{% block js %}
    {% compressed_js 'preferences' %}
    <script>
    $(document).ready(function(){
        var showhidden = false;
        $('.hiddenrow').toggle(showhidden);
        function getRow(elem) {
            return row = $(elem).closest("tr");
        };
        function getPrefId(row) {
            return id = $(row).children('.pref-id').eq(0).val();
        };
        function processFormChange(elem, val) {
            var row = getRow(elem);
            $(row).css('background', 'red')
            var data = {
                prefid: getPrefId(row),
                csrfmiddletoken: '{{ csrf_token }}',
            };
            var changedselname = $(elem).attr('name').split('-').slice(-1)[0];
            data[changedselname] = val;
            $.post('{% url 'preference-save' %}', data, 
                function(newRow){
                    row.replaceWith(newRow);
                    $('.hiddenrow').toggle(showhidden);
                }
            );
        };
        $("tr input").live('change', function(){
            var val = $(this).is(':checked')
            processFormChange(this, val);
        });
        $("tr select").live('change', function(){
            var val = $(this).val()
            processFormChange(this, val);
        });
        $(".toghidden").click(function(){
            showhidden = !showhidden;
            $('.hiddenrow').toggle(showhidden);
            $('.toghidden').toggle();
        });

    });
    </script>
{% endblock %}

{% block scripts %}
{% endblock %}


{% block top-bar %}
{% endblock %}

{% block content-width %}16{% endblock %}
{% block content %}
    <button type="submit" class="btn info toghidden">Pokaż ukryte</button>&nbsp;
    <button style="display: none;" type="submit" class="btn info toghidden">Ukryj ukryte</button>&nbsp;
    <table class="zebra-striped">
        <thead>
            <tr>
                <th>{% trans "Przedmiot" %}</th>
                <th>{% trans "Wykład" %}/{% trans "Seminarium" %}</th>
                <th>{% trans "Ćwiczenia" %}</th>
                <th>{% trans "Pracownia" %}/{% trans "Ćwiczenio-Pracownia" %}</th>
                <th>{% trans "Repetytorium" %}</th>
                <th>{% trans "Ukryte" %}
            </tr>
        </thead>
        {% for form in formset %}
            {% include "offer/preferences/form_row.html" %}
        {% endfor %}
        
    </table>
    <button type="submit" class="btn info toghidden">Pokaż ukryte</button>&nbsp;
    <button style="display: none;" type="submit" class="btn info toghidden">Ukryj ukryte</button>&nbsp;
{% endblock %}

{% block sidebar-width %}0{% endblock %}
{% block sidebar %}
{% endblock %}
