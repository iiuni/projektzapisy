{% extends "enrollment/base.html" %}
{% load url from future %}
{% load fereol_common %}
{% load compressed %}
{% load cache %}
{% load multifor %}
{% load i18n %}
{% block main-subtitle %}{# Translators: podtytuł #}{% trans "Plan zajęć" %}{% endblock %}


{% block content-width %}16{% endblock %}

{% block styles %}
    {% compressed_css 'schedule' %}
    <link rel='stylesheet' type='text/css' href='/site_media/js/fullcalendar/fullcalendar.css'/>
{% endblock %}
{% block js %}
    {% compressed_js 'schedule' %}
    <script type="text/javascript" src="/site_media/js/fullcalendar/fullcalendar.js"></script>
    <script>

        $(document).ready(function () {

            $('#calendar').fullCalendar({
                {#               defaultView: 'BasicWeek',#}
                header:{
                    left:'prev,next today',
                    center:'title',
                    right:'month,agendaWeek,agendaDay'
                },

                {##}
                               defaultView: 'agendaWeek',

                allDayDefault:false,
                buttonText:{
                    prev:'&nbsp;&#9668;&nbsp;',
                    next:'&nbsp;&#9658;&nbsp;',
                    prevYear:'&nbsp;&lt;&lt;&nbsp;',
                    nextYear:'&nbsp;&gt;&gt;&nbsp;',
                    today:'dziś',
                    month:'miesiąc',
                    week:'tydzień',
                    day:'dzień'
                },
                monthNames:['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec',
                    'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],
                monthNamesShort:['Sty', 'Lut', 'Mar', 'Kwi', 'Maj', 'Cze', 'Lip',
                    'Sie', 'Wrz', 'Paź', 'Lis', 'Gru'],
                dayNames:['Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'],
                dayNamesShort:['Ni', 'Pn', 'Wt', 'Śr', 'Cz', 'Pi', 'So'],
                firstHour:8,
                firstDay:1,
                allDaySlot:false,

                // time formats
                titleFormat:{
                    month:'MMMM yyyy',
                    week:"d {'&#8212;' d} MMM[ yyyy]{ [ MMM] yyyy}",
                    day:'dddd, d MMM, yyyy'
                },

                columnFormat:{
                    month:'ddd',
                    week:'ddd d.M',
                    day:'dddd d.M'
                },
                timeFormat:{ // for event elements
                    '':'HH(:mm)', // default

                    agenda:'HH:mm{ - HH:mm}'
                },
                minTime:8,
                maxTime:22,

                axisFormat:'HH(:mm)',
                events: '{% url 'events:my_schedule_ajax' %}'
            });

        });

    </script>
{% endblock %}

{% block enrollment_menu_schedule %} class="active"{% endblock %}

{% block bread %}
	<a href="{% url 'main-page' %}">{% trans "Strona główna" %}</a> &raquo;
	<a href="{% url 'enrollment-main' %}">{% trans "Zapisy" %}</a>

{% endblock %}

{% block center %}
    <div  style="float:right;margin-bottom: 20px;"><a href="{% url 'ical' %}">{% trans "Eksportuj zajęcia z bieżącego semestru do ical" %}</a>
    </div>

    <div class="row">
        <div class="span16">
            <div class="schedule-title"><h2>{% trans "Plan zajęć" %}</h2></div>
            
            {% if user.student %}
                <div class="schedule-header-ects-count"><h4>Punktów ECTS: {{ sum_points }}</h4></div>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="span16">
            <div id='calendar'></div>
        </div>
    </div>
	{% if user.student %}
        <h3>{% trans "Zajęcia, na które jesteś zapisany" %}</h3>
	<table id="enr-schedule-listByCourse" class="zebra-striped">
		<thead>
			<tr>
                {# Translators: Tytuł kolumny w tabelce #}
				<th>{% trans "Przedmiot" %}</th>
				{% if user.student %}
                    {# Translators: Tytuł kolumny w tabelce #}
                    <th class="ects">{% trans "ECTS" %}</th>
                {% else %}
                    {# Translators: Tytuł kolumny w tabelce #}
                    <th class="ects">{% trans "Godziny" %}</th>
                {% endif %}
			</tr>
		</thead>
		<tfoot>
			<tr>
			{% if user.student %}
				<td><strong>Suma punktów ECTS:</strong></td>
				<td class="ects">{{ sum_points }}</td>
{#            {% else %}#}
{#                <td>Liczba godzin:</td>#}
{#                <td class="ects">{{ hours_sum }}</td>    #}
            {% endif %}
			</tr>
		</tfoot>
		<tbody>
            {% regroup groups by group.course as courses %}
            {% for course in courses %}
            <tr class="courseHeader">
                <td class="name">
                    <a href="{% url 'course-page' course.grouper.slug %}">
                        {{ course.grouper.name }}
                    </a>

                </td>
                <td rowspan="2" class="ects">
                    {{ course.list.0.points }}
                </td>
            </tr>
            <tr class="courseDetails">
                <td>
                    <ul>
                        {% for item in course.list %}
                        {% with item.group as group %}
                        <li>
                            <span class="type">{{ group.get_type_display }}:</span>
                            {% for term in group.term.all %}
                            <span class="term">
                                {{ term.get_dayOfWeek_display }}
                                {{ term.start_time|time:'G:i' }}-{{ term.end_time|time:'G:i' }}
                            </span>
                            <span class="classroom">sala:
                                  {% for classroom in term.classrooms.all %}
                                    {{ classroom.number }}
                                  {% endfor %}
                            </span>
                            {% endfor %}
                            <input type="hidden" name="term" value="{{ term.json }}" />
                        </li>
                        {% endwith %}
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
		</tbody>
	</table>
    {% endif %}
{% endblock %}
